<!DOCTYPE html>
<html lang="jp">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <h1>ほしい本を見つける</h1>
    <!-- 結果を表示したいページを設定する -->
    <form action="/search-result/">
        <input id="search-input" placeholder="あなたの探したい本のキーワードを入力" type="text" name="search-key">
        <input id="search-buttom" class="fas" type="submit" value="" method="get">
      </form>

  <button id="btn">データ取得</button>
  <div id="output"></div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <!-- axiosライブラリの読み込み -->
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>



    <div class="contents">
        <h1>検索結果</h1>
        <ul id="ul">
        </ul>
      </div>
      <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script>
　//URLのパラメーターを取得
  let v = new URLSearchParams(window.location.search);
　//URLのパラメーターのうち検索されたキーワードを取得
  v = v.get('search-key');
//   const url = 'https://www.googleapis.com/books/v1/volumes?';
const url = 'https://www.googleapis.com/books/v1/volumes?q=intitle:犬の気持ち';
    
　//検索したい全てのURLを配列に格納
//   const urlLists = [
//     "/data/xml/",
//     "/site-speed/asynchronous/",
//     "/site-speed/for_while/",
//     "/site-speed/async-2/"];

//  $.each(urlLists, function(i){
//     $.ajax({
//       url　: urlLists[i],
//       dataType : 'html',
//       success　: function(data){
// 　　　   //上記のURLからキーワードを探す
//         if( $(data).find("#article").text().indexOf(v) !== -1){
// 　　　　　　//あれば、ページを表示する
//           $('<li><a href="' + urlLists[i] + '">' +$(data).find("h1").text() + '</a></li>').appendTo('ul');
//           }
//         },
//         error: function(data){
//           console.log("error")
//         }
//       });
//     });


// ボタンクリック時にデータを取得
$("#btn").on("click",function(){
// APIにリクエストを送るときはaxios.get()を使用
axios
.get(url)
.then(function (response) {
// リクエスト成功時の処理（responseに結果が入っている）
console.log(response);
// console.log(response.data.items[0].volumeInfo.title);
const data=[];
response.data.items.forEach(function(elm){
  data.push(`<p>${elm.volumeInfo.title}</p>`);
  data.push(`<img src=${elm.volumeInfo.imageLinks.smallThumbnail}>`);
});
$("#output").html(data);
})
.catch(function (error) {
// リクエスト失敗時の処理（errorにエラー内容が入っている）
console.log(error);
})
.finally(function () {
// 成功失敗に関わらず必ず実行
console.log('done!');
});
});
</script>
    
</body>
</html>